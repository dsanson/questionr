<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>Using the questionr package</title>

<base target="_blank"/>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
}

pre code {
   display: block; padding: 0.5em;
}

code.r {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}
</style>





</head>

<body>
<script type="text/javascript"> 
var student_answers = {};
var comments = {missing:"Missing answer", correct:"Correct", incorrect:"Incorrect"};
var student_id = "{{{STUDENT_ID}}}";
var page_id = "{{{PAGE_ID}}}";
</script>

<p><link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet"><br/>
<link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet"></p>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>

<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script> 

<script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.0.3/bootstrap.min.js"></script>

<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-tooltip.js"></script>

<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-popover.js"></script>

<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-modal.js"></script>

<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-button.js"></script>

<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-typeahead.js"></script>

<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-tab.js"></script>

<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-scrollspy.js"></script>

<div id='main_message'></div>

<p><header class="jumbotron subhead"><h1>Using the questionr package</h1><p class='lead'>Basic explanations</p></header></p>

<p><span><div id="navbar" class="navbar  navbar-fixed-top"><div class="navbar-inner"><ul id="navbar-header" class="nav"></ul></div></div></span><span id="subnav"></span></p>

<script>$('#navbar-header').append("<li><a href='#nav1' target='_self'>About</a></li>");</script>

<p><span><div id="nav1"></div></span><br/>
<span><div class='page-header'><h2>About</h2></div></span></p>

<p>The <code>questionr</code> package has two purposes:</p>

<ul>
<li><p>to make a simple to use template to make self-contained quizzes to put on the web</p></li>
<li><p>to create a basic web content management system to allow teachers and students to form sections of classes.</p></li>
</ul>

<p>The writing of quizzes, called &ldquo;projects&rdquo; below is discussed elsewhere. For the rest of this document we will discuss the basic web framework presented for holding a section.</p>

<script>$('#navbar-header').append("<li><a href='#nav2' target='_self'>Logging on</a></li>");</script>

<p><span><div id="nav2"></div></span><br/>
<span><div class='page-header'><h2>Logging on</h2></div></span></p>

<p>One goal of the project was to avoid having to deal with different<br/>
user logins and passwords. Students already have too many. The concept<br/>
of <code>openID</code> allows multiple websites to share login credentials. This<br/>
package uses <code>janrain.com</code> to provide a service that allows users to<br/>
login with several different account identities include <code>google</code> and<br/>
<code>yahoo</code> accounts. It is possible to link up with FaceBook accounts, but this hasn&#39;t been done.</p>

<p>Users should close the browser when finished if they wish to logout or<br/>
use the logout feature.</p>

<p>When a user first logs in, they are enrolled as a student in the<br/>
system. By default, a student is not part of any sections. They need to<br/>
enroll. A student has the option of enrolling in a public section or a<br/>
private one, if they know the section ID. The basic idea is a student<br/>
will be given a section ID by an instructor and they will then enroll.</p>

<p>A teacher must be given additional roles within the system. To make a request to be a teacher, requires someone to </p>

<ul>
<li><p>open an account as a student go to the page at</p></li>
<li><p><code>request_teacher_status</code> and make a request. This is not a link<br/>
available to the student and must be typed in. A system<br/>
adminstrator must authorize this new role.</p></li>
</ul>

<script>$('#navbar-header').append("<li><a href='#nav3' target='_self'>The student view</a></li>");</script>

<p><span><div id="nav3"></div></span><br/>
<span><div class='page-header'><h2>The student view</h2></div></span></p>

<p>Students have very limited options:</p>

<ul>
<li><p>They can enroll in a section if they know the id </p></li>
<li><p>They can view their work in each enrolled section</p></li>
<li><p>They can work on a project</p></li>
</ul>

<p>Working on a project is the only confusing aspect. Projects are one<br/>
long web page. Navigation is aided by a top-level navigation bar if<br/>
provided. A project can have several questions embedded in it. These<br/>
questions can be written to be self grading or may need to be graded<br/>
by the teacher of the section. Questions can have a badge to keep<br/>
track of the number of attempts, comments on a particular attempt, and<br/>
hints to aid in the question. Whether these features is present<br/>
depends on the project as written.</p>

<p>The basic flow is that student answer the questions as indicated. When<br/>
done they can &ldquo;save&rdquo; the work for their return or they can submit the<br/>
work to be graded. Once submitted, no more changes are possible.</p>

<p>The main student view shows the graded work and gives links to work on<br/>
projects. In addition messages left for the student are displayed<br/>
here.</p>

<script>$('#navbar-header').append("<li><a href='#nav4' target='_self'>The teacher view</a></li>");</script>

<p><span><div id="nav4"></div></span><br/>
<span><div class='page-header'><h2>The teacher view</h2></div></span></p>

<p>Teachers have many possibilities</p>

<ul>
<li><p>They can admit students into a section. The basic idea is a student<br/>
is given an ID to allow them to request enrollment. You can veto<br/>
this enrollment, if desired.</p></li>
<li><p>They can create a class. A class is a collection of projects with some order. The form to edit a class allows you to created a new class or modify an existing one.</p></li>
<li><p>They can create a section. Students enroll in sections. Sections<br/>
have a list of projects and a list of students. The projects can be<br/>
cloned from an existing class allowing one to create sections for<br/>
different semesters or time periods. Projects can be<br/>
added/deleted/edited or viewed. It is important to be careful when<br/>
modifying a project if students have already started doing that<br/>
work.</p></li>
<li><p>They can leave a student a message. Sections or students can have a<br/>
message left for them using this form.</p></li>
</ul>

<!--- Finish this off -->

<script>
$('body').css('margin', '40px 10px');
//$('body').attr('data-offset','40');
//$('body').attr('data-target','#subnav');
$('body').attr('data-spy','scroll');
//$('[data-spy="scroll"]').each(function () {
//   var $spy = $(this).scrollspy('refresh')
//});
</script>

<div id='grade_alert'></div>

<script>

var tmp = $(".nav-tabs")
$.each(tmp, function(key, value) {
  $("#" + value.id + " a:first").tab("show")
});
 
$("#navbar").scrollspy();
$("body").attr("data-spy", "scroll");
$("[data-spy=\'scroll\']").each(function () {
  var $spy = $(this).scrollspy("refresh")
});

function comment_default(grade, stud_ans, comment, def) {
    var cmt = "";
    if(grade == 100) {
    cmt = def.correct;
    } else if(typeof(comment) != "undefined") {
    if(typeof(comment[stud_ans]) != "undefined") {
        cmt = comment[stud_ans];
    } else {
        cmt = def.incorrect;
    }
    } else {
    cmt = def.incorrect;
    }
    return cmt;
};

function comment_checkgroup(grade, stud_ans, comment, def) {
    var tmp = []; 
    $.each(stud_ans, function(key, value) {tmp.push(value)});
    return comment_default(grade, tmp.sort().join("::"), comment, def);
};

function comment_numeric(grade, stud_ans, value, comment, def) {
    var cmt = "";
    if(grade == 100) {
    cmt = def.correct;
    } else if(typeof(comment) != "undefined") {
    if(stud_ans < value[0]) {
        if(typeof(comment.less) != "undefined") {
        cmt = comment.less
        } else {
        cmt = def.incorrect
        }
    } else if(stud_ans > value[1]) {
        if(typeof(comment.more) != "undefined") {
        cmt = comment.more
        } else {
        cmt = def.incorrect
        }
    }
    } else {
    cmt = def.incorrect;
    }
    return cmt;
}
function grade_radio(ans, value) {return( ans == value ? 100 : 0) };
function grade_checkboxgroup(ans, value) {
  var out=[];
  $.each(ans, function(key, value) { if(value != null) { out.push(value) }});
  if(out.length != value.length) { return(0) };
  out = out.sort();
  var value = value.sort()
  for(var i=0; i < out.length; i++) {
    if(out[i] != value[i]) { return(0) }
  }
  return(100)
};
function grade_typeahead(ans, value) { return( (ans == value) ? 100 : 0 )};
function grade_combo(ans, value) { return( (ans == value) ? 100 : 0) };
function grade_numeric(ans, value) { return( (ans >= value[0] && ans <= value[1]) ? 100 : 0) };



function submit_work(status) {
    $.ajax({
    url:"/set_answers",
    type:"POST",
    data: {
        answers:JSON.stringify(student_answers),
        status:status,
        project_id:page_id
    },
    success:function(data) {
        window.location.replace("");
    }
    });
};

function set_radio(id, value) {
  $("#" + id + " [value=" + value + "]").attr("checked", true);
};

function set_checkboxgroup(id, value) {
  $("#" + id + " [type=checkbox]").attr("checked", false);
  $.each(value, function(idx, val) {
    $("#" + id + " [value=" + val + "]").attr("checked", true)
  })
};


function set_typeahead(id, value) {
    $("#" + id).val(value)
};

function set_combo(id, value) {
    if(value.length > 0) {
    $("#" + id + " [value=" + value + "]").attr("selected", true)
    } else {
    $("#" + id)[0].selectedIndex=0;
    }

};

function set_numeric(id, value) {
    $("#" + id).val(value)
};

function set_free(id, value) {
    $("#" + id).val(value);
};

function set_answer(o) {
    var id = o.problem; 
    var value = o.answer;
    var type = o.type
    if(type == "radio") {
    set_radio(id, value)
    } else if(type == "checkbox") {
    set_checkboxgroup(id, value)
    } else if(type == "typeahead") {
    set_typeahead(id, value)
    } else if(type == "combo") {
    set_combo(id, value)
    } else if(type == "numeric") {
    set_numeric(id, value)
    } else if(type == "free") {
    set_free(id, value)
    }
};

function set_answers(status, stud_ans) {
    $.each(stud_ans, function(key, value) {
    set_answer(value);
    if(typeof(value.comment) != "undefined") {
        var cmt = '<div class="alert"><a class="close" data-dismiss="alert" href="#">×</a>' + value.comment + '</div>'
        var x =  $("#" + value.problem + "_help");
        if(x.length > 0) {
        x[0].innerHTML = cmt;
        }
        if(status == "graded") {
        var x =  $("#" + value.problem + "_comment");
        if(x.length > 0) {
            x[0].innerHTML = cmt;
        }
        }
    }
    });
};

var is_open=false;

function write_grade_table() {
    var a = student_answers;
    if(is_open) {
    $("#gradealert").alert('close');
    } else {
    $("#grade_alert").append('<div id = "fillmein"></div>');

    $("#fillmein").append('<div id="gradealert" class="alert alert-block fade in"><button class="close" data-dismiss="alert">×</button>');
    $("#gradealert").append('<h2>Congratulations, your scores so far are:</h2>');  
    $("#gradealert").append('<table id="grade_alert_table" class="table table-bordered table-striped">');
    $("#gradealert").append("</table></div>");
    
    $("#grade_alert_table").append('<thead><tr><th>Problem</th><th>Score</th><th>Comment</th></tr></thead><tbody>');

    var icon_lookup = {true:"icon-thumbs-up", false:"icon-thumbs-down", missing:"icon-warning-sign"};
    var msg_lookup = {true:"Correct", false: "Incorrect", missing:"Missing"};

    $.each(a, function() {
        $("#grade_alert_table").append("<tr>" +
                       "<td>" + 
                       "<a class='grade_clicker' href='#" + this.problem + "' target='_self'>" +
                       "Problem " + this.problem.replace("prob_", "") + "</a></td>" +
                       " <td>" + 
                       "<i class='" + icon_lookup[this.grade] + "'></i>&nbsp;" +
                       msg_lookup[this.grade] + "</td>" +
                       "<td>" + this.comment + "</td>" +
                       "</tr>");
    })
        $("#grade_alert_table").append('</tbody>');
    $(".grade_clicker").each(function() { this.onclick = function() {$("#gradealert").alert('close')}})
        $("#gradealert").alert();
    is_open = true;
    $("#gradealert").bind("closed", function() {is_open=false});
    }
};
$(document).ready(function() {
    $(".btn").button()

    var cmt_defaults={correct:comments.correct, 
              incorrect:comments.incorrect,
              missing:comments.missing
             }; 
    var fix_badge = function(key, tries, answer, comment) {
    $('#' + key + "_badge").each(function() {this.innerHTML = tries + (tries == 1 ? " try" : " tries")});
    $.each(['badge-info', 'badge-warning', 'badge-success'], function(idx, value) {
        $('#' + key + "_badge").removeClass(value)
    });
    if(answer == true) {
        $('#' + key + "_badge").addClass("badge-success");
    } else {
        $('#' + key + "_badge").addClass("badge-warning");
    };
    $('#' + key + "_help").each(function() {
        this.innerHTML=
        "<div class='alert alert-info'><a class='close' data-dismiss='alert' href='#'>×</a>" + comment + "</div>";
    });
    
    }
    var close_comment = function(key) {
    $("#" + key + "_comment > .alert").alert("close");
    };
    $("[type=\'radio\']").each(function() {
    student_answers[this.name]={problem:this.name, type:'radio', tries:0};
    this.onchange = function() {
        var key = this.name;
        var sans = this.value;
        var answer = grade_radio(sans, actual_answers[key].value);
        var comment = comment_default(answer, sans, comments[key], cmt_defaults); 
        var tries = student_answers[key].tries + 1;
        student_answers[key] = {
        problem:key,
        type:'radio',
        tries:tries,
        answer:sans,
        grade:answer,
        comment:comment
        };
        fix_badge(key, tries, answer, comment);
    }
    }
                  );
    $("[type=\'checkbox\']").each(function() {
    var n = $("#" + this.name + "> .checkbox").length
    var ans = {};
    for(i=1; i <= n; i++) {ans[this.name + "_" + i] = null;}
    student_answers[this.name] = {
        problem: this.name,
        type:'checkbox',
        tries:0,
        answer:ans
    };
    this.onchange = function() {
        var key = this.name;
        var sans = student_answers[key].answer;
        if(this.checked) {
        sans[this.id] = this.value;
        } else {
        sans[this.id] = null;
        }
        var answer = grade_checkboxgroup(sans, actual_answers[key].value);
        var comment = comment_checkgroup(answer, sans, comments[key], cmt_defaults); 
        var tries = student_answers[key].tries + 1;

        student_answers[key] = {
        problem:key,
        type:'checkbox',
        tries:tries,
        answer:sans,
        grade:answer,
        comment:comment
        };
        fix_badge(key, tries, answer, comment)
    }
    });
    $(".typeahead").each(function() {
    if(this.id.length > 0) {
        student_answers[this.id]={problem:this.id, type:'typeahead',  tries:0};
    }
    this.onchange = function() {
        var key = this.id;
        var sans = this.value;
        var answer = grade_typeahead(sans, actual_answers[key].value);
        var comment = comment_default(answer, sans, comments[key], cmt_defaults); 
        var tries = student_answers[key].tries + 1;

        student_answers[key] = {
        problem:key,
        type:"typeahead",
        tries:student_answers[key].tries + 1,
        answer:sans,
        grade:answer,
        comment:comment
        };
        fix_badge(key, tries, answer, comment)
    }
    });
    
    $(".combobox").each(function() { 
    student_answers[this.id]={problem:this.id, type:'combo', tries:0};
    this.onchange = function() {
        var key = this.id;
        var sans = this.value;
        var answer = grade_combo(sans, actual_answers[key].value);
        var comment = comment_default(answer, sans, comments[key], cmt_defaults); 
        var tries = student_answers[key].tries + 1;

        student_answers[key] = {
        problem:key,
        type:"combo",
        tries:tries,
        answer:sans,
        grade:answer,
        comment:comment
        };
        fix_badge(key, tries, answer, comment)
    }
    });
    $(".numeric_answer").each(function() {
    student_answers[this.id]={problem:this.id, type:'numeric', tries:0};
    this.onchange = function() {
        var key = this.id;
        var sans = this.value;
        var answer = grade_numeric(sans, actual_answers[key].value);
        var comment = comment_numeric(answer, sans, 
                      actual_answers[key].value,
                      comments[key],
                      cmt_defaults); 
        var tries = student_answers[key].tries + 1;

        student_answers[key] = {
        problem:key,
        type:"numeric",
        tries:tries,
        answer:sans,
        grade:answer,
        comment:comment
        };
        fix_badge(key, tries, answer, comment)
    }
    });
    $(".free").each(function() {
    student_answers[this.id]={problem:this.id, type:'free', tries:0};
    this.onchange = function() {
        var key = this.id;
        var sans = this.value;
        student_answers[key].answer = sans;
    };
    });

    var restore_badges = function(x) {
    $.each(x, function(key, value) {
    var badge = $("#" + key + "_badge");
    if(badge.length > 0) {
        var tries = x[key].tries;
        badge[0].innerHTML = tries + " tries"
    }
    })
}
    // get answers from server, restore
    $.ajax({
    url:"http://localhost:9000/custom/quizr/get_answers", 
    type:'POST',
    data:{ project_id:page_id}, 
    success:function(data, status, jqxhr) {
       
        if(data.status == "error") {
        return null;
        }
        
        student_answers = data.answers;
        set_answers(data.status, data.answers);
        restore_badges(student_answers);

        if(data.status == "graded") {
        // no more changes!
        $("button").addClass("disabled");
        $("button").each(function() {this.onclick=null});
            
        $.each($('[id*="prob"]'), function() {this.onchange = null});
        $("input").attr("disabled", "disabled");
        $("select").attr("disabled", "disabled");
        
        $(".badge").each(function() {this.innerHTML = "graded"});

        $("#main_message").append('<div class="alert alert-block alert-info"><a class="close" data-dismiss="alert" href="#">×</a><b>This was already graded</b>, no more changes are possible.</div>');
        }
    }
    });
});
</script>

<script>var actual_answers=[];</script>

<script>comments={ "missing": "Missing answer","correct": "Correct answer","incorrect": "Incorrect answer" };</script>

</body>

</html>
